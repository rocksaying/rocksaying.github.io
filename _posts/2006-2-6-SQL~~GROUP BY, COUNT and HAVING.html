---
title: SQL~~GROUP BY, COUNT and HAVING
category: programming
old-category: SQL/Database
tags: []
---
<p>
欲得知資源被使用次數大於 1 的報表。資源使用記錄儲存在資料表 rsu 中，其中 uno 欄位為資源代碼，資源每被使用一次 ，就會在 rsu 表中增加一筆使用記錄。故需使用 COUNT() 做計數動作，並指定搜尋條件為計數值大於 1 者。但在合計操作中 (It, '合計操作', means a query with aggregate method.) ，不能使用 WHERE 為條件表示，而應使用 HAVING 。
</p>

<!--more-->
<pre class="highlight"><code><span class="k">select</span> <span class="n">rsu</span><span class="p">.</span><span class="n">uno</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="n">rsu</span><span class="p">.</span><span class="n">uno</span><span class="p">)</span> <span class="k">as</span> <span class="n">counts</span> <span class="k">from</span> <span class="n">rsu</span>
<span class="k">where</span> <span class="n">rsu</span><span class="p">.</span><span class="n">record_date</span> <span class="o">=</span> <span class="s1">'2006-02-04'</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">rsu</span><span class="p">.</span><span class="n">uno</span> <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="n">rsu</span><span class="p">.</span><span class="n">uno</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
</code></pre>

<p>
最常見的 aggregate method 就是 SUM() 和 COUNT()  。由於 aggregate method 往往要搭配 GROUP BY 使用，因此對 GROUP BY 和 HAVING 的用法，產生了一個常見的誤解，即以為 HAVING 只能用在 GROUP BY 之後。然而， HAVING 其實是用於對 aggregate method 之結果作條件篩選，由於 aggregate method 可以不配合 GROUP BY 使用，所以 HAVING 也可以出現在沒有 GROUP BY 的查詢中。
</p>
<h6>相關文章</h6>
<ul>
<li><a href="{{ site.baseurl }}/archives/2006/%E5%88%86%E7%B5%84%E7%B5%B1%E8%A8%88%E7%9A%84%E4%BA%8C%E7%A8%AE%E6%9F%A5%E8%A9%A2%E6%95%98%E8%BF%B0.html">sql</a></li>
</ul>
<div class="note">樂多舊網址: http://blog.roodo.com/rocksaying/archives/1092066.html</div>