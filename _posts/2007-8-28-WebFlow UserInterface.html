---
title: WebFlow UserInterface
category: programming
old-category: JavaScript
tags: []
---
<p>
流程編輯器。使用 JavaScript 實作的使用者介面，未附伺服端儲存與載入功能源碼。
</p>
<p>
使用 <a href="http://www.walterzorn.com">wz_jsgraphics.js</a> 繪製線條。當時曾試過 SVG ，但效果與瀏覽器相容性皆不理想，所以還是用 wz_jsgraphics.js 。它是以 1px 大小的 div node 為畫素，構成圖形。
</p>

<!--more-->
操作圖例:
<img src="http://blog.roodo.com/rocksaying/09df92b2.png" alt="WebFlow操作圖例" />
<h6>FlowNode.js</h6>
<p>Flow object。資料結構。</p>
<pre class="highlight"><code><span class="cm">/*
Copyright (c) 2006 Shih Yuncheng. All rights reserved.

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License (LGPL) as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.
*/</span>

<span class="kd">function</span> <span class="nx">NodeIndex</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">level</span> <span class="o">=</span> <span class="nx">l</span><span class="p">;</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">n</span><span class="p">;</span>
	<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">NodeIndex</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">return</span> <span class="s2">"("</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">level</span> <span class="o">+</span> <span class="s2">","</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">+</span> <span class="s2">")"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">FlowNode</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">items</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span>
	<span class="c1">//this.items.push(null); //每一新節點的會辦者為 END</span>
	<span class="c1">//this.backs = new Array();</span>
	<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">FlowNode</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//每一層級至少有一節點。</span>
<span class="kd">function</span> <span class="nx">FlowLevel</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">nodes</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">FlowNode</span><span class="p">(</span><span class="nx">name</span><span class="p">));</span>
	<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">FlowLevel</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">nodes</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">nodes</span><span class="p">;</span>
	<span class="c1">//nodes[nodes.length] = new FlowNode(name);</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">name</span><span class="p">)</span>
	        <span class="k">return</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FlowNode</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
	<span class="nx">nodes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
	<span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*
  Flow
*/</span>
<span class="kd">function</span> <span class="nx">Flow</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">levels</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">FlowLevel</span><span class="p">(</span><span class="s2">""</span><span class="p">));</span> <span class="c1">// Node END, Flow.levels[0]</span>
	<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">Flow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getNodeIndex</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">levels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="s2">""</span><span class="p">)</span>
	    <span class="k">return</span> <span class="k">new</span> <span class="nx">NodeIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">nodes</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">;</span>
	    <span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">arrayHasItem</span><span class="p">(</span><span class="nx">nodes</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
	    <span class="k">if</span><span class="p">(</span> <span class="nx">j</span> <span class="o">&gt;=</span><span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
	        <span class="k">return</span> <span class="k">new</span> <span class="nx">NodeIndex</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">Flow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getNodeByName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">nodeName</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">levels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">nodeName</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">nodeName</span> <span class="o">==</span> <span class="s2">""</span><span class="p">)</span>
	    <span class="k">return</span> <span class="nx">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="cm">/*null*/</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">nodes</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">;</span>
	    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	        <span class="k">if</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">nodeName</span><span class="p">)</span> <span class="p">{</span>
	            <span class="k">return</span> <span class="nx">nodes</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/*
Flow.prototype.removeNodeFromItem = function(node) {
	if(node == null)
	    return;
	var levels = this.levels;
	var nodes;
	for(var i=1; i &lt; levels.length; i++) {
	    nodes = levels[i].nodes;

	    for(var j = 0; j &lt; nodes.length; j++) {
			this.removeItem(i, j, node);
		}
	}
}
*/</span>
<span class="nx">Flow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">replaceNodeInItems</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">replaceWithItems</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">node</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
	    <span class="k">return</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">levels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">nodes</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nx">nodes</span> <span class="o">=</span> <span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">;</span>

	    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">k</span> <span class="o">&lt;</span> <span class="nx">replaceWithItems</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hasItem</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="nx">j</span><span class="p">,</span><span class="nx">node</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		        	<span class="k">this</span><span class="p">.</span><span class="nx">addItem</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">replaceWithItems</span><span class="p">[</span><span class="nx">k</span><span class="p">]);</span>
				<span class="p">}</span>
		    <span class="p">}</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">node</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="nx">Flow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">insertLevel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">indexOfLevel</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">fromNode</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">levels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">indexOfLevel</span> <span class="o">&gt;</span> <span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
		<span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getNodeByName</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
	    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">//已存在 (可能在不同層級)</span>

	<span class="nx">levels</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">indexOfLevel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">new</span> <span class="nx">FlowLevel</span><span class="p">(</span><span class="nx">name</span><span class="p">));</span>

	<span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="k">if</span><span class="p">(</span><span class="nx">fromNode</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">//node.items.pop();</span>
		<span class="c1">// remove the Node END; 新層級會包含一個新節點，而新節點的會辦者預設為 END</span>
		<span class="k">while</span><span class="p">(</span><span class="nx">fromNode</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">node</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">fromNode</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">pop</span><span class="p">());</span>
			<span class="c1">//新層級之新節點之會辦者，為處理者的會辦者。</span>
		<span class="p">}</span>
		<span class="nx">fromNode</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
		<span class="c1">//將新節點加入處理者的會辦者中</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">];</span>
<span class="p">}</span>

<span class="nx">Flow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeLevel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">indexOfLevel</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">levels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">indexOfLevel</span> <span class="o">!=</span> <span class="nx">levels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
	<span class="c1">// NOTE: 層級移除策略未定。暫定只能移除最後一個層級。</span>

	<span class="k">if</span><span class="p">(</span><span class="nx">indexOfLevel</span> <span class="o">&gt;</span> <span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
	    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">level</span> <span class="o">=</span> <span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">];</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">level</span><span class="p">.</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
	    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
	<span class="c1">//只有一個參與者時，才可移除層級</span>
	<span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">level</span><span class="p">.</span><span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">replaceNodeInItems</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">items</span><span class="p">);</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">indexOfLevel</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">Flow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">indexOfLevel</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">fromNode</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">levels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">indexOfLevel</span> <span class="o">&gt;</span> <span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
		<span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getNodeByName</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">//已存在 (可能在不同層級)</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">addNode</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">fromNode</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">fromNode</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="c1">//node.items.push(new NodeIndex(0,0));</span>
		<span class="k">return</span> <span class="nx">node</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="nx">Flow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">indexOfLevel</span><span class="p">,</span> <span class="nx">indexOfNode</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">indexOfLevel</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">indexOfNode</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
		<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">//一個層級至少要有一個節點。</span>

	<span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">indexOfNode</span><span class="p">];</span>
	<span class="c1">//只有一個會辦者，且其為 END ，才可移除</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span><span class="c1">//if(node.items.length &lt;= 1 /*&amp;&amp; node.items[0] == null*/) {</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">replaceNodeInItems</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">items</span><span class="p">);</span>

		<span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">indexOfNode</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">Flow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateNode</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">indexOfLevel</span><span class="p">,</span> <span class="nx">indexOfNode</span><span class="p">,</span> <span class="nx">nodeData</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">indexOfLevel</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">indexOfNode</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
		<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getNodeByName</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">//不存在</span>
	<span class="p">}</span>

	<span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">indexOfNode</span><span class="p">];</span>
	<span class="kd">var</span> <span class="nx">oldNode</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FlowNode</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">nodeData</span><span class="p">[</span><span class="s1">'name'</span><span class="p">])</span> <span class="p">{</span>
	    <span class="nx">node</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">nodeData</span><span class="p">[</span><span class="s1">'name'</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="k">this</span><span class="p">.</span><span class="nx">replaceNodeInItems</span><span class="p">(</span><span class="nx">oldNode</span><span class="p">,</span> <span class="p">[</span><span class="nx">node</span><span class="p">]);</span>

	<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">Flow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">arrayHasItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ar</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ar</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">ar</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">item</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">item</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="s2">""</span><span class="p">))</span>
			<span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">ar</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="nx">item</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">ar</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">==</span> <span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
				<span class="k">return</span> <span class="nx">i</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">Flow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">indexOfLevel</span><span class="p">,</span> <span class="nx">indexOfNode</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">indexOfLevel</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">indexOfNode</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">arrayHasItem</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">indexOfNode</span><span class="p">].</span><span class="nx">items</span><span class="p">,</span> <span class="nx">item</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">Flow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">indexOfLevel</span><span class="p">,</span> <span class="nx">indexOfNode</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">indexOfLevel</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">indexOfNode</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
		<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">indexOfNode</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
		<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">indexOfNode</span><span class="p">].</span><span class="nx">items</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hasItem</span><span class="p">(</span><span class="nx">indexOfLevel</span><span class="p">,</span> <span class="nx">indexOfNode</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">items</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">Flow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">indexOfLevel</span><span class="p">,</span> <span class="nx">indexOfNode</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">indexOfLevel</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span> <span class="o">||</span> <span class="nx">indexOfNode</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
		<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>

	<span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">indexOfLevel</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">indexOfNode</span><span class="p">].</span><span class="nx">items</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">name</span> <span class="o">==</span> <span class="s2">""</span><span class="p">)</span>
		<span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">hasItem</span><span class="p">(</span><span class="nx">indexOfLevel</span><span class="p">,</span> <span class="nx">indexOfNode</span><span class="p">,</span> <span class="nx">item</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">items</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/*
Flow.prototype.nodeEnd = function() {
	//return this.levels[0].nodes[0];
	return null;
}
*/</span>
</code></pre>


<h6>WebFlow.js</h6>
<p>流程編輯功能。源碼不展開。</p>
<pre class="highlight"><code><span class="cm">/*
Copyright (c) 2006 Shih Yuncheng. All rights reserved.

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License (LGPL) as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.
*/</span>

<span class="kd">function</span> <span class="nx">hiddenFlowMenu1</span><span class="p">()</span> <span class="p">{</span>
	<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenu1"</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">mouseOverMenuItem</span><span class="p">(</span><span class="nx">menuItem</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">menuItem</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">"MenuItemMouseOver"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">mouseOutMenuItem</span><span class="p">(</span><span class="nx">menuItem</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">menuItem</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">"MenuItem"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">showFlowMenu1</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">menu</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenu1"</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span> <span class="o">!=</span> <span class="nx">l</span> <span class="o">||</span> <span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">node</span> <span class="o">!=</span> <span class="nx">n</span> <span class="o">||</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">==</span> <span class="s1">'hidden'</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">setCurrentNode</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span><span class="nx">n</span><span class="p">);</span>
		<span class="nx">menu</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">"關卡: "</span> <span class="o">+</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">n</span><span class="p">];</span> <span class="c1">//+ "(" + l + "," + n + ")";</span>
		<span class="nx">menu</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">"&lt;ul&gt;"</span><span class="p">;</span>
		<span class="nx">menu</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">"&lt;li onClick='showAddItem();' onMouseOver='mouseOverMenuItem(this);' onMouseOut='mouseOutMenuItem(this);'&gt;新增關卡&lt;/li&gt;"</span><span class="p">;</span>
		<span class="nx">menu</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">"&lt;li onClick='showUpdateNode();' onMouseOver='mouseOverMenuItem(this);' onMouseOut='mouseOutMenuItem(this);'&gt;修改關卡&lt;/li&gt;"</span><span class="p">;</span>
		<span class="nx">menu</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">"&lt;li onClick='showRemoveNode();' onMouseOver='mouseOverMenuItem(this);' onMouseOut='mouseOutMenuItem(this);'&gt;刪除關卡&lt;/li&gt;"</span><span class="p">;</span>
		<span class="nx">menu</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">"&lt;li onClick='showRemoveItem();' onMouseOver='mouseOverMenuItem(this);' onMouseOut='mouseOutMenuItem(this);'&gt;移除會辦者&lt;/li&gt;"</span><span class="p">;</span>
		<span class="nx">menu</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">"&lt;/ul&gt;"</span><span class="p">;</span>
		<span class="nx">layoutToElement</span><span class="p">(</span><span class="s2">"FlowMenu1"</span><span class="p">,</span> <span class="nx">obj</span><span class="p">);</span>
	    <span class="nx">menu</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s1">'visible'</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span>
	    <span class="nx">menu</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s1">'hidden'</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">layoutToElement</span><span class="p">(</span><span class="nx">objId</span><span class="p">,</span> <span class="nx">layoutToObj</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">objId</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
		<span class="kd">var</span> <span class="nx">cs</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span>

		<span class="c1">//if(cs.visibility == 'hidden') {</span>
			<span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="nx">layoutToObj</span><span class="p">;</span>
			<span class="kd">var</span> <span class="nx">x</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
			<span class="kd">var</span> <span class="nx">y</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
			<span class="k">while</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">offsetParent</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">x</span><span class="o">+=</span><span class="nx">o</span><span class="p">.</span><span class="nx">offsetLeft</span><span class="p">;</span>
				<span class="nx">y</span><span class="o">+=</span><span class="nx">o</span><span class="p">.</span><span class="nx">offsetTop</span><span class="p">;</span>
				<span class="nx">o</span><span class="o">=</span><span class="nx">o</span><span class="p">.</span><span class="nx">offsetParent</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="c1">//cs.top=(y+layoutToObj.offsetHeight)+'px';</span>
			<span class="c1">//cs.left=x+'px';</span>
			<span class="nx">cs</span><span class="p">.</span><span class="nx">top</span><span class="o">=</span><span class="nx">y</span><span class="o">+</span><span class="s1">'px'</span><span class="p">;</span>
			<span class="nx">cs</span><span class="p">.</span><span class="nx">left</span><span class="o">=</span><span class="p">(</span><span class="nx">x</span><span class="o">+</span><span class="nx">layoutToObj</span><span class="p">.</span><span class="nx">offsetWidth</span><span class="p">)</span><span class="o">+</span><span class="s1">'px'</span><span class="p">;</span>
		<span class="c1">//	cs.visibility='visible';</span>
		<span class="c1">//}</span>
		<span class="c1">//else {</span>
		<span class="c1">//	cs.visibility='hidden';</span>
		<span class="c1">//}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">setCurrentNode</span><span class="p">(</span><span class="nx">l</span><span class="p">,</span> <span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span> <span class="o">=</span> <span class="nx">l</span><span class="p">;</span>
	<span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">n</span><span class="p">;</span>
	<span class="nx">currentNode</span> <span class="o">=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">n</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getNewLevelName</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuAddNewLevel"</span><span class="p">).</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="s2">"nodeName"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">return</span> <span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">cancleAddNewLevel</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuAddNewLevel"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
	<span class="nx">hiddenFlowMenu1</span><span class="p">();</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">submitAddNewLevel</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuAddNewLevel"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="c1">//textbox.value = "";</span>
    <span class="c1">//layoutToElement("FlowMenuAddNewLevel", document.getElementById("FlowMenu1"));</span>
    <span class="nx">hiddenFlowMenu1</span><span class="p">();</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nx">flow</span><span class="p">.</span><span class="nx">insertLevel</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">currentNode</span><span class="p">);</span>
	    <span class="nx">renderFlowTable</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">showAddNewLevel</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuAddNewLevel"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="nx">layoutToElement</span><span class="p">(</span><span class="s2">"FlowMenuAddNewLevel"</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenu1"</span><span class="p">));</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"visible"</span><span class="p">;</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getNewNodeName</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuAddNewNode"</span><span class="p">).</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="s2">"nodeName"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">return</span> <span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">cancleAddNewNode</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuAddNewNode"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
	<span class="nx">hiddenFlowMenu1</span><span class="p">();</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">submitAddNewNode</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuAddNewNode"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="c1">//textbox.value = "";</span>
    <span class="c1">//layoutToElement("FlowMenuAddNewLevel", document.getElementById("FlowMenu1"));</span>
    <span class="nx">hiddenFlowMenu1</span><span class="p">();</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
	    <span class="kd">var</span> <span class="nx">rc</span><span class="p">;</span>
	    <span class="k">if</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span> <span class="o">&gt;=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span> <span class="p">{</span>
		    <span class="nx">rc</span> <span class="o">=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">insertLevel</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">currentNode</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
		    <span class="nx">rc</span> <span class="o">=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">addNode</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">currentNode</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">rc</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">alert</span><span class="p">(</span><span class="s2">"不允許新增，可能已存在。"</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="nx">renderFlowTable</span><span class="p">();</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">hideAddNewNode</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuAddNewNode"</span><span class="p">);</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
	<span class="nx">bodyControler</span><span class="p">.</span><span class="nx">removeClickHandler</span><span class="p">(</span><span class="nx">hideAddNewNode</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">showAddNewNode</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuAddNewNode"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="nx">layoutToElement</span><span class="p">(</span><span class="s2">"FlowMenuAddNewNode"</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenu1"</span><span class="p">));</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"visible"</span><span class="p">;</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">cancleUpdateNode</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuUpdateNode"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
	<span class="nx">hiddenFlowMenu1</span><span class="p">();</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">submitUpdateNode</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuUpdateNode"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="c1">//textbox.value = "";</span>
    <span class="c1">//layoutToElement("FlowMenuAddNewLevel", document.getElementById("FlowMenu1"));</span>
    <span class="nx">hiddenFlowMenu1</span><span class="p">();</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s2">""</span> <span class="o">&amp;&amp;</span> <span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="nx">currentNode</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
	    <span class="kd">var</span> <span class="nx">rc</span><span class="p">;</span>
	    <span class="nx">rc</span> <span class="o">=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">updateNode</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="p">,</span> <span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span><span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span><span class="p">});</span>
		<span class="nx">renderFlowTable</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">showUpdateNode</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuUpdateNode"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">currentNode</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
    <span class="nx">layoutToElement</span><span class="p">(</span><span class="s2">"FlowMenuUpdateNode"</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenu1"</span><span class="p">));</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"visible"</span><span class="p">;</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getItemName</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuAddItem"</span><span class="p">).</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="s2">"nodeName"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">return</span> <span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">cancleAddItem</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuAddItem"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="nx">hiddenFlowMenu1</span><span class="p">();</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">submitAddItem</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuAddItem"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="c1">//textbox.value = "";</span>
    <span class="c1">//layoutToElement("FlowMenuAddNewLevel", document.getElementById("FlowMenu1"));</span>
    <span class="nx">hiddenFlowMenu1</span><span class="p">();</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">rc</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">flow</span><span class="p">.</span><span class="nx">getNodeByName</span><span class="p">(</span><span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    	<span class="k">if</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span> <span class="o">&gt;=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span><span class="mi">1</span> <span class="p">)</span> <span class="p">{</span>
	    	<span class="nx">rc</span> <span class="o">=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">insertLevel</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">currentNode</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
	    	<span class="nx">rc</span> <span class="o">=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">addNode</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="nx">currentNode</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span>
	    <span class="nx">flow</span><span class="p">.</span><span class="nx">addItem</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="p">,</span> <span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">getNodeByName</span><span class="p">(</span><span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="nx">renderFlowTable</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">showAddItem</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuAddItem"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

	<span class="kd">var</span> <span class="nx">nodeList</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"select"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">while</span><span class="p">(</span><span class="nx">nodeList</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">nodeList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="nx">nodeList</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Option</span><span class="p">(</span><span class="s2">"請選擇"</span><span class="p">,</span> <span class="s2">"0"</span><span class="p">);</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>  <span class="p">{</span>
	        <span class="k">if</span><span class="p">(</span><span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">node</span><span class="p">].</span><span class="nx">name</span>
			  <span class="o">!=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">name</span>
			  <span class="o">&amp;&amp;</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">hasItem</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="p">,</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span><span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">j</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="nx">nodeList</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">nodeList</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Option</span><span class="p">(</span><span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">name</span><span class="p">,</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">name</span><span class="p">);</span>
	        <span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="nx">nodeList</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">nodeList</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Option</span><span class="p">(</span><span class="s2">"結案"</span><span class="p">,</span> <span class="s2">""</span><span class="p">);</span>

    <span class="nx">layoutToElement</span><span class="p">(</span><span class="s2">"FlowMenuAddItem"</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenu1"</span><span class="p">));</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"visible"</span><span class="p">;</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">cancleRemoveItem</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuRemoveItem"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
	<span class="nx">hiddenFlowMenu1</span><span class="p">();</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">submitRemoveItem</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuRemoveItem"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="c1">//textbox.value = "";</span>
    <span class="c1">//layoutToElement("FlowMenuAddNewLevel", document.getElementById("FlowMenu1"));</span>
    <span class="nx">hiddenFlowMenu1</span><span class="p">();</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
	<span class="c1">//if(textbox.value != "") {</span>
	<span class="c1">//window.alert(flow.getNodeByName(textbox.value));</span>
	    <span class="nx">flow</span><span class="p">.</span><span class="nx">removeItem</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="p">,</span> <span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">getNodeByName</span><span class="p">(</span><span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span><span class="p">));</span>
	    <span class="nx">renderFlowTable</span><span class="p">();</span>
	<span class="c1">//}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">showRemoveItem</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuRemoveItem"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>

	<span class="kd">var</span> <span class="nx">nodeList</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"select"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">while</span><span class="p">(</span><span class="nx">nodeList</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">nodeList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="nx">nodeList</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Option</span><span class="p">(</span><span class="s2">"請選擇"</span><span class="p">,</span> <span class="s2">"0"</span><span class="p">);</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">currentNode</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">currentNode</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">currentNode</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">==</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">nodeList</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">nodeList</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Option</span><span class="p">(</span><span class="s2">"結案"</span><span class="p">,</span> <span class="s2">""</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="nx">nodeList</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">nodeList</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Option</span><span class="p">(</span><span class="nx">currentNode</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">,</span> <span class="nx">currentNode</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

    <span class="nx">layoutToElement</span><span class="p">(</span><span class="s2">"FlowMenuRemoveItem"</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenu1"</span><span class="p">));</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"visible"</span><span class="p">;</span>
	<span class="nx">textbox</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">cancleRemoveNode</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuRemoveNode"</span><span class="p">);</span>
	<span class="c1">//var textbox = obj.getElementsByTagName("input")[0];</span>
	<span class="c1">//textbox.value = "";</span>
	<span class="nx">hiddenFlowMenu1</span><span class="p">();</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">submitRemoveNode</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuRemoveNode"</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">textbox</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="c1">//textbox.value = "";</span>
    <span class="c1">//layoutToElement("FlowMenuAddNewLevel", document.getElementById("FlowMenu1"));</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"hidden"</span><span class="p">;</span>
	<span class="nx">hiddenFlowMenu1</span><span class="p">();</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
	    <span class="k">return</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    	<span class="nx">flow</span><span class="p">.</span><span class="nx">removeLevel</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span>
    	<span class="nx">flow</span><span class="p">.</span><span class="nx">removeNode</span><span class="p">(</span><span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="p">,</span> <span class="nx">currentNodeIndex</span><span class="p">.</span><span class="nx">node</span><span class="p">);</span>
	<span class="p">}</span>
    <span class="nx">renderFlowTable</span><span class="p">();</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">showRemoveNode</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenuRemoveNode"</span><span class="p">);</span>
	<span class="c1">//var textbox = obj.getElementsByTagName("input")[0];</span>
	<span class="c1">//textbox.value = "";</span>
    <span class="nx">layoutToElement</span><span class="p">(</span><span class="s2">"FlowMenuRemoveNode"</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"FlowMenu1"</span><span class="p">));</span>
	<span class="nx">obj</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s2">"visible"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">renderFlowTable</span><span class="p">()</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"div1"</span><span class="p">);</span>

	<span class="kd">var</span> <span class="nx">offsetX</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">offsetY</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="nx">div</span><span class="p">;</span>
	<span class="k">while</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">offsetParent</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">offsetX</span> <span class="o">+=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">offsetLeft</span><span class="p">;</span>
		<span class="nx">offsetY</span> <span class="o">+=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">offsetTop</span><span class="p">;</span>
		<span class="nx">o</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">offsetParent</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kd">var</span> <span class="nx">nodes</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">maxNodes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">maxWidth</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="o">+</span><span class="mi">80</span><span class="p">)</span> <span class="o">*</span> <span class="nx">maxNodes</span> <span class="o">-</span> <span class="mi">20</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">(</span><span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"div"</span><span class="p">);</span>
			<span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">].</span><span class="nx">className</span> <span class="o">=</span> <span class="s2">"FlowNode"</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">maxNodes</span> <span class="o">&lt;</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nx">maxNodes</span> <span class="o">=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
			<span class="nx">maxWidth</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="o">+</span><span class="mi">80</span><span class="p">)</span> <span class="o">*</span> <span class="nx">maxNodes</span> <span class="o">-</span> <span class="mi">20</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">offsetLeft</span> <span class="o">=</span> <span class="nx">offsetX</span> <span class="o">+</span><span class="p">((</span><span class="nx">maxWidth</span> <span class="o">-</span> <span class="p">((</span><span class="mi">20</span><span class="o">+</span><span class="mi">80</span><span class="p">)</span><span class="o">*</span><span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">20</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>


	<span class="nx">jg_doc</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
	<span class="cm">/*for(var i=0; i &lt; div.childNodes.length; i++) {
	    div.removeChild(div.childNodes[i]);
	}*/</span>

	<span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offsetLeft</span> <span class="o">=</span> <span class="nx">offsetX</span> <span class="o">+</span> <span class="p">((</span><span class="nx">maxWidth</span> <span class="o">-</span> <span class="p">((</span><span class="mi">20</span><span class="o">+</span><span class="mi">80</span><span class="p">)</span><span class="o">*</span><span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">20</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
	<span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">"&lt;input type='button' value='結案'/&gt;"</span><span class="p">;</span>
   	<span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">offsetY</span> <span class="o">+</span> <span class="p">((</span><span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">40</span><span class="p">))</span> <span class="o">+</span> <span class="s1">'px'</span><span class="p">;</span>
   	<span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">offsetX</span> <span class="o">+</span> <span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offsetLeft</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="mi">80</span><span class="p">))</span> <span class="o">+</span> <span class="s1">'px'</span><span class="p">;</span>
   	<span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">[</span><span class="s1">'width'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span> <span class="o">+</span> <span class="s1">'px'</span><span class="p">;</span>
   	<span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">[</span><span class="s1">'height'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span> <span class="o">+</span> <span class="s1">'px'</span><span class="p">;</span>
   	<span class="nx">div</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>


	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">"&lt;input type='button' value='"</span>
				<span class="o">+</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span> <span class="o">+</span> <span class="s2">"' onClick='showFlowMenu1(this,"</span><span class="o">+</span><span class="nx">i</span><span class="o">+</span><span class="s2">","</span><span class="o">+</span><span class="nx">j</span><span class="o">+</span><span class="s2">");'/&gt;"</span><span class="p">;</span><span class="c1">//+ flow.levels[i].nodes[j].items.join(",");</span>
			<span class="k">if</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">].</span><span class="nx">addEventListener</span><span class="p">)</span> <span class="p">{</span>
				<span class="c1">//nodes[i][j].addEventListener("mouseover", function(event){this.className = 'FlowMenuItemMouseOver';}, false);</span>
				<span class="c1">//nodes[i][j].addEventListener("mouseout", function(event){this.className = 'FlowMenuItem';}, false);</span>
			<span class="p">}</span>
			<span class="k">else</span> <span class="p">{</span> <span class="c1">// M$IE</span>
				<span class="c1">//nodes[i][j].onmouseover = function(){this.className = 'FlowMenuItemMouseOver';};</span>
				<span class="c1">//nodes[i][j].onmouseout = function(){this.className = 'FlowMenuItem';};</span>
			<span class="p">}</span>
	    	<span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">offsetY</span> <span class="o">+</span><span class="p">((</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">40</span><span class="p">))</span> <span class="o">+</span> <span class="s1">'px'</span><span class="p">;</span>
	    	<span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">offsetX</span> <span class="o">+</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">offsetLeft</span> <span class="o">+</span> <span class="p">(</span><span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="mi">80</span><span class="p">))</span> <span class="o">+</span> <span class="s1">'px'</span><span class="p">;</span>
	    	<span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">].</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">[</span><span class="s1">'width'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span> <span class="o">+</span> <span class="s1">'px'</span><span class="p">;</span>
	    	<span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">].</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"input"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">[</span><span class="s1">'height'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span> <span class="o">+</span> <span class="s1">'px'</span><span class="p">;</span>

	    	<span class="nx">div</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="c1">//var EndNodeIndex = new NodeIndex(flow.levels.length,0);</span>

	<span class="nx">jg_doc</span><span class="p">.</span><span class="nx">setColor</span><span class="p">(</span><span class="s2">"#0000ff"</span><span class="p">);</span> <span class="c1">// green</span>
	<span class="c1">//jg_doc.drawLine(100, 50, 200, 400);</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	    <span class="c1">//var currentLevelLeft = (maxWidth - ((20+80)*flow.levels[i].nodes.length - 20)) / 2;</span>
		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">item</span><span class="p">;</span>
			<span class="kd">var</span> <span class="nx">nodeIndex</span><span class="p">;</span>
		    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">k</span> <span class="o">&lt;</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		        <span class="nx">item</span> <span class="o">=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">j</span><span class="p">].</span><span class="nx">items</span><span class="p">[</span><span class="nx">k</span><span class="p">];</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">item</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="o">==</span><span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
				    <span class="c1">//nodeIndex = EndNodeIndex;</span>
					<span class="nx">jg_doc</span><span class="p">.</span><span class="nx">drawLine</span><span class="p">(</span>
						<span class="nx">offsetX</span><span class="o">+</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">offsetLeft</span><span class="o">+</span><span class="p">(</span><span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="mi">80</span><span class="p">)</span> <span class="o">+</span> <span class="mi">40</span><span class="p">),</span>
						<span class="nx">offsetY</span><span class="o">+</span><span class="p">((</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">40</span><span class="p">)</span><span class="o">+</span><span class="mi">40</span><span class="p">),</span>
						<span class="nx">offsetX</span><span class="o">+</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">offsetLeft</span><span class="o">+</span><span class="p">(</span><span class="mi">0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="mi">80</span><span class="p">)</span><span class="o">+</span><span class="mi">40</span><span class="p">),</span>
						<span class="nx">offsetY</span><span class="o">+</span><span class="p">((</span><span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">50</span><span class="o">+</span><span class="mi">40</span><span class="p">)));</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="nx">nodeIndex</span> <span class="o">=</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">getNodeIndex</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
					<span class="k">if</span><span class="p">(</span><span class="nx">nodeIndex</span><span class="p">.</span><span class="nx">level</span> <span class="o">&gt;</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
						<span class="nx">jg_doc</span><span class="p">.</span><span class="nx">drawLine</span><span class="p">(</span>
							<span class="nx">offsetX</span><span class="o">+</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">offsetLeft</span><span class="o">+</span><span class="p">(</span><span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="mi">80</span><span class="p">)</span> <span class="o">+</span> <span class="mi">40</span><span class="p">),</span>
							<span class="nx">offsetY</span><span class="o">+</span><span class="p">((</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">40</span><span class="p">)</span><span class="o">+</span><span class="mi">40</span><span class="p">),</span>
							<span class="nx">offsetX</span><span class="o">+</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">nodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="p">].</span><span class="nx">offsetLeft</span><span class="o">+</span><span class="p">(</span><span class="nx">nodeIndex</span><span class="p">.</span><span class="nx">node</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="mi">80</span><span class="p">)</span><span class="o">+</span><span class="mi">40</span><span class="p">),</span>
							<span class="nx">offsetY</span><span class="o">+</span><span class="p">((</span><span class="nx">nodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">50</span><span class="o">+</span><span class="mi">40</span><span class="p">)));</span>
					<span class="p">}</span>
					<span class="k">else</span> <span class="p">{</span>
						<span class="nx">jg_doc</span><span class="p">.</span><span class="nx">drawLine</span><span class="p">(</span>
							<span class="nx">offsetX</span><span class="o">+</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">offsetLeft</span><span class="o">+</span><span class="p">(</span><span class="nx">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="mi">80</span><span class="p">)</span> <span class="o">+</span> <span class="mi">40</span><span class="p">),</span>
							<span class="nx">offsetY</span><span class="o">+</span><span class="p">((</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">50</span> <span class="o">+</span> <span class="mi">40</span><span class="p">)),</span>
							<span class="nx">offsetX</span><span class="o">+</span><span class="p">(</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">nodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="p">].</span><span class="nx">offsetLeft</span><span class="o">+</span><span class="p">(</span><span class="nx">nodeIndex</span><span class="p">.</span><span class="nx">node</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="mi">80</span><span class="p">)</span><span class="o">+</span><span class="mi">40</span><span class="p">),</span>
							<span class="nx">offsetY</span><span class="o">+</span><span class="p">((</span><span class="nx">nodeIndex</span><span class="p">.</span><span class="nx">level</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">50</span><span class="o">+</span><span class="mi">40</span><span class="p">)</span><span class="o">+</span><span class="mi">40</span><span class="p">));</span>
					<span class="p">}</span>
				<span class="p">}</span>
				<span class="c1">//window.alert(item + nodeIndex);</span>
		    <span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="nx">jg_doc</span><span class="p">.</span><span class="nx">paint</span><span class="p">();</span> <span class="c1">// draws, in this case, directly into the document</span>

<span class="p">}</span>
</code></pre>


<h6>FlowTableSubmit.js</h6>
<p>送出編輯內容。此處僅將結果顯示於網頁上，並未送回伺服端。請依實作規格自行補上伺服端的部份。
</p>
<p>
我當時是把內容轉成 JSON 格式後送回伺服端儲存。伺服端是以 C#/ASP.Net 實作。我並未擁有伺服端的著作權，故不發佈伺服端源碼。
</p>
<pre class="highlight"><code><span class="cm">/*
Copyright (c) 2006 Shih Yuncheng. All rights reserved.

This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License (LGPL) as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.
*/</span>

<span class="kd">function</span> <span class="nx">openString</span><span class="p">()</span> <span class="p">{</span>
	<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"div1"</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s2">"&lt;ol&gt;"</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">closeString</span><span class="p">()</span> <span class="p">{</span>
	<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"div1"</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">"&lt;/ol&gt;"</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">addString</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">div1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"div1"</span><span class="p">);</span>
	<span class="nx">div1</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">"&lt;li&gt;"</span> <span class="o">+</span> <span class="nx">v</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">"&lt;br/&gt; Items: "</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">div1</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">","</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="nx">div1</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">"&lt;br/&gt; Backs: "</span><span class="p">;</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">backs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">div1</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">backs</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">","</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nx">div1</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">"&lt;/li&gt;"</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">addRow</span><span class="p">(</span><span class="nx">tableId</span><span class="p">,</span> <span class="nx">level</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">table1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">tableId</span><span class="p">).</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"tbody"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>

	<span class="kd">var</span> <span class="nx">tdLevel</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"td"</span><span class="p">);</span>
	<span class="nx">tdLevel</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">level</span><span class="p">;</span>

	<span class="kd">var</span> <span class="nx">tdName</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"td"</span><span class="p">);</span>
	<span class="nx">tdName</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>

	<span class="kd">var</span> <span class="nx">tdItems</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"td"</span><span class="p">);</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
            <span class="nx">tdItems</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">","</span><span class="p">;</span>
		<span class="k">if</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
	    	<span class="nx">tdItems</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
		<span class="k">else</span>
            <span class="nx">tdItems</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">+=</span> <span class="s2">"結案"</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="kd">var</span> <span class="nx">tr</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">"tr"</span><span class="p">);</span>
	<span class="nx">tr</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">tdLevel</span><span class="p">);</span>
	<span class="nx">tr</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">tdName</span><span class="p">);</span>
	<span class="nx">tr</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">tdItems</span><span class="p">);</span>
<span class="c1">//	tr.appendChild(tdBacks);</span>

	<span class="nx">table1</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">tr</span><span class="p">);</span>
<span class="p">}</span>
<span class="kd">function</span> <span class="nx">X_renderFlowTable</span><span class="p">()</span> <span class="p">{</span>
	<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"div1"</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="s1">'hidden'</span><span class="p">;</span>
	<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"table2"</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span><span class="o">=</span><span class="s1">'visible'</span><span class="p">;</span>
	<span class="kd">var</span> <span class="nx">table1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"table2"</span><span class="p">).</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"tbody"</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
	<span class="kd">var</span> <span class="nx">trs</span> <span class="o">=</span> <span class="nx">table1</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">"tr"</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="nx">trs</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">table1</span><span class="p">.</span><span class="nx">deleteRow</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">//using Table Object Model;</span>
	<span class="p">}</span>

	<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">l</span> <span class="o">&lt;</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">l</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">n</span> <span class="o">&lt;</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">nodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
	    	<span class="nx">addRow</span><span class="p">(</span><span class="s2">"table2"</span><span class="p">,</span> <span class="nx">l</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">flow</span><span class="p">.</span><span class="nx">levels</span><span class="p">[</span><span class="nx">l</span><span class="p">].</span><span class="nx">nodes</span><span class="p">[</span><span class="nx">n</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre>


<h6>WebFlow.sql</h6>
<p>WebFlow SQL schema.</p>
<pre class="highlight"><code><span class="c1">-- when insert, the column which IDENTITY could be ignored.
-- Note: IDENTITY only in M$ SQL Server, not SQL-92 Standard.
</span><span class="k">create</span> <span class="k">table</span> <span class="n">WebFlowMaster</span> <span class="p">(</span>
	<span class="n">WebFlowID</span> <span class="n">int</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
	<span class="n">Description</span> <span class="n">text</span> <span class="k">not</span> <span class="k">null</span> <span class="k">default</span> <span class="s1">''</span><span class="p">,</span>
	<span class="n">ModifyEmployee</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
	<span class="n">ModifyMemo</span> <span class="n">text</span> <span class="k">not</span> <span class="k">null</span> <span class="k">default</span> <span class="s1">''</span><span class="p">,</span>
	<span class="n">ModifyTime</span> <span class="n">datetime</span> <span class="k">not</span> <span class="k">null</span>
<span class="p">);</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">WebFlowDetail</span> <span class="p">(</span>
	<span class="n">WebFlowID</span> <span class="n">int</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
	<span class="n">FlowLevel</span> <span class="n">int</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
	<span class="n">NodeID</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span><span class="p">,</span>
	<span class="n">ItemIDs</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span> <span class="k">not</span> <span class="k">null</span>
	<span class="c1">-- text will not allow to insert with select union in SQLServer.
</span>	<span class="c1">--SQL Sever線上說明:
</span>    <span class="c1">--在 SQL Server 版本 7.0 上，execute_statement 無法包含會
</span>    <span class="c1">--傳回 text 或 image 資料行的延伸預存程序。
</span>    <span class="c1">--此行為是對先前 SQL Server 版本的一項變更。
</span><span class="p">);</span>

<span class="c1">--select WFM.WebFlowID.*, N.FlowLevel, N.NodeID, I.ItemID
--from WebFlowMaster as WFM
--inner join (WebFlowNode as N inner join WebFlowItem as I
--  on N.WebFlowID = I.WebFlowID and N.NodeID = I.NodeID)
--on WFM.WebFlowID = N.WebFlowID
</span>
<span class="k">create</span> <span class="k">procedure</span> <span class="n">dt_WebFlowMasterInsert</span> <span class="p">(</span>
	<span class="o">@</span><span class="n">WebFlowID</span> <span class="n">int</span> <span class="k">output</span><span class="p">,</span>
	<span class="o">@</span><span class="n">Description</span> <span class="n">text</span><span class="p">,</span>
	<span class="o">@</span><span class="n">ModifyEmployee</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
	<span class="o">@</span><span class="n">ModifyMemo</span> <span class="n">text</span><span class="p">,</span>
	<span class="o">@</span><span class="n">ModifyTime</span> <span class="n">datetime</span>
<span class="p">)</span>
<span class="k">AS</span>
<span class="k">BEGIN</span>
<span class="k">Insert</span> <span class="k">Into</span> <span class="n">WebFlowMaster</span> <span class="p">(</span>
	<span class="n">Description</span><span class="p">,</span>
	<span class="n">ModifyEmployee</span><span class="p">,</span>
	<span class="n">ModifyMemo</span><span class="p">,</span>
	<span class="n">ModifyTime</span>
<span class="p">)</span>
<span class="k">Values</span> <span class="p">(</span>
	<span class="o">@</span><span class="n">Description</span><span class="p">,</span>
	<span class="o">@</span><span class="n">ModifyEmployee</span><span class="p">,</span>
	<span class="o">@</span><span class="n">ModifyMemo</span><span class="p">,</span>
	<span class="o">@</span><span class="n">ModifyTime</span>
<span class="p">);</span>

<span class="k">Set</span> <span class="o">@</span><span class="n">WebFlowID</span> <span class="o">=</span> <span class="n">SCOPE_IDENTITY</span><span class="p">();</span>

<span class="k">END</span>
<span class="k">GO</span>

<span class="k">create</span> <span class="k">procedure</span> <span class="n">dt_WebFlowMasterUpdate</span> <span class="p">(</span>
	<span class="o">@</span><span class="n">WebFlowID</span> <span class="n">int</span><span class="p">,</span>
	<span class="o">@</span><span class="n">Description</span> <span class="n">text</span><span class="p">,</span>
	<span class="o">@</span><span class="n">ModifyEmployee</span> <span class="n">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
	<span class="o">@</span><span class="n">ModifyMemo</span> <span class="n">text</span><span class="p">,</span>
	<span class="o">@</span><span class="n">ModifyTime</span> <span class="n">datetime</span>
<span class="p">)</span>
<span class="k">AS</span>
<span class="k">BEGIN</span>
<span class="k">Update</span> <span class="n">WebFlowMaster</span> <span class="k">set</span>
	<span class="n">Description</span> <span class="o">=</span> <span class="o">@</span><span class="n">Description</span><span class="p">,</span>
	<span class="n">ModifyEmployee</span> <span class="o">=</span> <span class="o">@</span><span class="n">ModifyEmployee</span><span class="p">,</span>
	<span class="n">ModifyMemo</span> <span class="o">=</span> <span class="o">@</span><span class="n">ModifyMemo</span><span class="p">,</span>
	<span class="n">ModifyTime</span> <span class="o">=</span> <span class="o">@</span><span class="n">ModifyTime</span>
<span class="k">where</span> <span class="n">WebFlowID</span> <span class="o">=</span> <span class="o">@</span><span class="n">WebFlowID</span><span class="p">;</span>

<span class="k">END</span>
<span class="k">GO</span>
</code></pre>


<h6>WebFlow.css</h6>
<p>視覺元件外觀。</p>
<pre class="highlight"><code><span class="nc">.FlowNode</span> <span class="p">{</span>
	<span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
	<span class="nl">width</span><span class="p">:</span> <span class="m">80px</span><span class="p">;</span>
	<span class="nl">height</span><span class="p">:</span> <span class="m">40px</span><span class="p">;</span>
	<span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="no">black</span><span class="p">;</span>
	<span class="nl">z-index</span><span class="p">:</span> <span class="m">100</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.FlowMenu1</span> <span class="p">{</span>
	<span class="nl">position</span><span class="p">:</span><span class="nb">absolute</span><span class="p">;</span>
	<span class="nl">background-color</span><span class="p">:</span> <span class="no">lightgrey</span><span class="p">;</span>
	<span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="no">black</span><span class="p">;</span>
	<span class="nl">visibility</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>
	<span class="nl">z-index</span><span class="p">:</span> <span class="m">500</span><span class="p">;</span>
	<span class="nl">padding</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
	<span class="nl">width</span><span class="p">:</span> <span class="m">120px</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.FlowSubMenu1</span> <span class="p">{</span>
	<span class="nl">position</span><span class="p">:</span><span class="nb">absolute</span><span class="p">;</span>
	<span class="nl">background-color</span><span class="p">:</span> <span class="no">lightgrey</span><span class="p">;</span>
	<span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="no">black</span><span class="p">;</span>
	<span class="nl">visibility</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>
	<span class="nl">z-index</span><span class="p">:</span> <span class="m">500</span><span class="p">;</span>
	<span class="nl">padding</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
	<span class="nl">width</span><span class="p">:</span> <span class="m">360px</span><span class="p">;</span>
	<span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.MenuItemMouseOver</span> <span class="p">{</span>
	<span class="nl">background-color</span><span class="p">:</span> <span class="m">#fcfcfc</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.MenuItem</span> <span class="p">{</span>
	<span class="nl">background-color</span><span class="p">:</span> <span class="no">lightgrey</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">#div1</span> <span class="p">{</span>
	<span class="nl">position</span><span class="p">:</span><span class="nb">relative</span><span class="p">;</span>
	<span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="p">}</span>
<span class="nf">#div2</span> <span class="p">{</span>
	<span class="nl">position</span><span class="p">:</span><span class="nb">absolute</span><span class="p">;</span>
	<span class="nl">left</span><span class="p">:</span> <span class="m">200px</span><span class="p">;</span>
	<span class="nl">top</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>


<h6>WebFlow.html</h6>
<p>主程式。</p>
<pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"WebFlow.css"</span> <span class="na">type=</span><span class="s">"text/css"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"wz_jsgraphics.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"FlowNode.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"WebFlow.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"FlowTableSubmit.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body</span> <span class="na">onClick=</span><span class="s">"bodyControler.clickHandler();"</span><span class="nt">&gt;</span>

<span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"FlowMenu1"</span> <span class="na">class=</span><span class="s">"FlowMenu1"</span><span class="nt">&gt;&lt;/span&gt;</span>

<span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"FlowMenuAddNewLevel"</span> <span class="na">class=</span><span class="s">"FlowSubMenu1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>關卡名稱: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"nodeName"</span> <span class="nt">/&gt;&lt;/label&gt;&lt;br/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"確定"</span> <span class="na">onClick=</span><span class="s">"submitAddNewLevel();"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"取消"</span> <span class="na">onClick=</span><span class="s">"cancleAddNewLevel();"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/span&gt;</span>

<span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"FlowMenuAddNewNode"</span> <span class="na">class=</span><span class="s">"FlowSubMenu1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;fieldset&gt;</span>
    <span class="nt">&lt;legend&gt;</span>新增關卡<span class="nt">&lt;/legend&gt;</span>
    <span class="nt">&lt;label&gt;</span>關卡名稱: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"nodeName"</span> <span class="nt">/&gt;&lt;/label&gt;&lt;br/&gt;</span>
    <span class="nt">&lt;/fieldset&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">align=</span><span class="s">"center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"確定"</span> <span class="na">onClick=</span><span class="s">"submitAddNewNode();"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"取消"</span> <span class="na">onClick=</span><span class="s">"cancleAddNewNode();"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/span&gt;</span>

<span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"FlowMenuUpdateNode"</span> <span class="na">class=</span><span class="s">"FlowSubMenu1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;fieldset&gt;</span>
    <span class="nt">&lt;legend&gt;</span>修改關卡<span class="nt">&lt;/legend&gt;</span>
    <span class="nt">&lt;label&gt;</span>關卡名稱: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"nodeName"</span> <span class="nt">/&gt;&lt;/label&gt;&lt;br/&gt;</span>
    <span class="nt">&lt;/fieldset&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">align=</span><span class="s">"center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"確定"</span> <span class="na">onClick=</span><span class="s">"submitUpdateNode();"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"取消"</span> <span class="na">onClick=</span><span class="s">"cancleUpdateNode();"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/span&gt;</span>

<span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"FlowMenuAddItem"</span> <span class="na">class=</span><span class="s">"FlowSubMenu1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;fieldset&gt;</span>
    <span class="nt">&lt;legend&gt;</span>新增會辦者<span class="nt">&lt;/legend&gt;</span>
    <span class="nt">&lt;label&gt;</span>關卡名稱: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"nodeName"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"nodeList"</span> <span class="na">onChange=</span><span class="s">"if(this.selectedIndex &gt; 0){document.getElementById('FlowMenuAddItem').getElementsByTagName('input')[0].value = this.options[this.selectedIndex].value};"</span><span class="nt">&gt;&lt;/select&gt;&lt;/label&gt;&lt;br/&gt;</span>
    <span class="nt">&lt;/fieldset&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">align=</span><span class="s">"center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"確定"</span> <span class="na">onClick=</span><span class="s">"submitAddItem();"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"取消"</span> <span class="na">onClick=</span><span class="s">"cancleAddItem();"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/span&gt;</span>

<span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"FlowMenuRemoveItem"</span> <span class="na">class=</span><span class="s">"FlowSubMenu1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;fieldset&gt;</span>
    <span class="nt">&lt;legend&gt;</span>移除會辦者<span class="nt">&lt;/legend&gt;</span>
    <span class="nt">&lt;label&gt;</span>關卡名稱: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"nodeName"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">name=</span><span class="s">"nodeList"</span> <span class="na">onChange=</span><span class="s">"if(this.selectedIndex &gt; 0){document.getElementById('FlowMenuRemoveItem').getElementsByTagName('input')[0].value = this.options[this.selectedIndex].value};"</span><span class="nt">&gt;&lt;/select&gt;&lt;/label&gt;&lt;/label&gt;&lt;br/&gt;</span>
    <span class="nt">&lt;/fieldset&gt;</span>
    <span class="nt">&lt;p</span> <span class="na">align=</span><span class="s">"center"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"確定"</span> <span class="na">onClick=</span><span class="s">"submitRemoveItem();"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"取消"</span> <span class="na">onClick=</span><span class="s">"cancleRemoveItem();"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/span&gt;</span>

<span class="nt">&lt;span</span> <span class="na">id=</span><span class="s">"FlowMenuRemoveNode"</span> <span class="na">class=</span><span class="s">"FlowSubMenu1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;label&gt;</span>確定刪除?<span class="nt">&lt;/label&gt;&lt;br/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"確定"</span> <span class="na">onClick=</span><span class="s">"submitRemoveNode();"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">value=</span><span class="s">"取消"</span> <span class="na">onClick=</span><span class="s">"cancleRemoveNode();"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/span&gt;</span>

<span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">"table2"</span> <span class="na">border=</span><span class="s">"1"</span> <span class="na">style=</span><span class="s">'visibility:hidden'</span><span class="nt">&gt;</span>
<span class="nt">&lt;tboby&gt;</span>
<span class="nt">&lt;tr&gt;</span>
	<span class="nt">&lt;td&gt;</span>Level<span class="nt">&lt;/td&gt;</span>
	<span class="nt">&lt;td&gt;</span>Node<span class="nt">&lt;/td&gt;</span>
	<span class="nt">&lt;td&gt;</span>Items<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"div1"</span> <span class="na">class=</span><span class="s">"div1"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">"div2"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/canvas&gt;</span>

<span class="nt">&lt;form&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">'button'</span> <span class="na">value=</span><span class="s">'送出表格'</span> <span class="na">onClick=</span><span class="s">'X_renderFlowTable();'</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/form&gt;</span>

<span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
var currentNode;
var currentNodeIndex = new NodeIndex(0,0);
var jg_doc = new jsGraphics("div1");

var canvas = document.getElementById('div2');
if (canvas.getContext) {
	var ctx = canvas.getContext('2d');
}

var bodyControler = {
	currentNode: null,
	currentNodeIndex: new NodeIndex(0,0),
	jg: new jsGraphics("div1"),

	currentObject: null,

	_clickHandlers: new Array(),

	addClickHandler: function(func) {
		this._clickHandlers.push(func);
	},

	removeClickHandler: function(func) {
	    for(var i = 0; i <span class="nt">&lt; this._clickHandlers.length</span><span class="err">;</span> <span class="err">i++)</span> <span class="err">{</span>
	        <span class="err">if(this._clickHandlers[i]</span> <span class="err">===</span> <span class="err">func)</span> <span class="err">{</span>
	            <span class="err">this._clickHandlers.splice(i,</span> <span class="err">1);</span>
	            <span class="err">break;</span>
			<span class="err">}</span>
		<span class="err">}</span>
	<span class="err">},</span>

	<span class="err">clickHandler:</span> <span class="err">function()</span> <span class="err">{</span>
		<span class="err">for(var</span> <span class="na">i =</span> <span class="s">0;</span> <span class="err">i</span> <span class="err">&lt;</span> <span class="err">this._clickHandlers.length;</span> <span class="err">i++)</span> <span class="err">{</span>
		    <span class="err">this._clickHandlers[i]();</span>
		<span class="err">}</span>
	<span class="err">}</span>
<span class="err">};</span>

<span class="err">/*=============================================*/</span>

<span class="err">var</span> <span class="na">flow =</span> <span class="s">new</span> <span class="err">Flow();</span>

<span class="err">flow.insertLevel(1,</span> <span class="err">"申請人",</span> <span class="err">null);</span>
<span class="err">flow.addItem(1,0,null);</span>
<span class="err">//flow.insertLevel(2,</span> <span class="err">"A1",</span> <span class="err">flow.levels[1].nodes[0]);</span>
<span class="err">//flow.addNode(2,"A2",flow.levels[1].nodes[0])</span>

<span class="err">renderFlowTable();</span>

<span class="err">&lt;/script</span><span class="nt">&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>

<p>
這是我一年前在某公司任職時寫的，算是程式雛型。當時最主要的困難點是在瀏覽器頁面上「畫圖／線」。試了包括 SVG 的多種方式後皆不可行，最後還是用 <a href="http://www.walterzorn.com">wz_jsgraphics.js</a> 解決。日後待網頁向量圖形規格確認與普及後，再改寫吧。
</p><div class="note">樂多舊網址: <a href="http://blog.roodo.com/rocksaying/archives/4036079.html">http://blog.roodo.com/rocksaying/archives/4036079.html</a></div>