---
title: SQL~~ 使用 CASE 修飾資料內容，以便進行 group 操作
category: programming
old-category: SQL/Database
tags: []
---
<p>
出貨單表格 sale_orders (saleno: 出貨單號, cno: 客戶單號, sale_date: 出貨日期, amt: 訂購總金額)。有 M, PH, YA 三處通路，來自 M 通路的客戶訂單，單號為 'M' 開頭，餘類推。欲查詢 2006 年一月份，三處通路的客戶訂單總金額。
</p>

<!--more-->
<p>
使用 CASE 修飾單號，將 M 開頭單號者，顯示為 'M通路' ，餘類推。如此便可再以 GROUP 進行群組求總和的操作。
</p>
<pre class="highlight"><code><span class="k">select</span> <span class="n">sale_stat</span><span class="p">.</span><span class="n">place</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">sale_stat</span><span class="p">.</span><span class="n">amt</span><span class="p">)</span> <span class="k">as</span> <span class="n">tamt</span>
<span class="k">from</span> <span class="p">(</span><span class="k">select</span> <span class="n">saleno</span><span class="p">,</span>
        <span class="k">case</span>
            <span class="k">when</span> <span class="n">cno</span> <span class="k">like</span> <span class="s1">'M%'</span> <span class="k">then</span> <span class="s1">'M通路'</span>
            <span class="k">when</span> <span class="n">cno</span> <span class="k">like</span> <span class="s1">'PH%'</span> <span class="k">then</span> <span class="s1">'PH通路'</span>
            <span class="k">when</span> <span class="n">cno</span> <span class="k">like</span> <span class="s1">'YA%'</span> <span class="k">then</span> <span class="s1">'YA通路'</span>
        <span class="k">end</span> <span class="k">as</span> <span class="n">place</span><span class="p">,</span>
        <span class="n">amt</span>
    <span class="k">from</span> <span class="n">sale_orders</span>
    <span class="k">where</span> <span class="p">(</span><span class="n">cno</span> <span class="k">like</span> <span class="s1">'M%'</span>  <span class="k">or</span> <span class="n">cno</span> <span class="k">like</span> <span class="s1">'PH%'</span> <span class="k">or</span> <span class="n">cno</span> <span class="k">like</span> <span class="s1">'YA%'</span><span class="p">)</span>
    <span class="k">and</span> <span class="n">sale_date</span> <span class="o">&gt;=</span> <span class="s1">'20060101'</span> <span class="k">and</span> <span class="n">sale_date</span> <span class="o">&lt;=</span> <span class="s1">'20060131'</span> <span class="p">)</span>
<span class="k">as</span> <span class="n">sale_stat</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">sale_stat</span><span class="p">.</span><span class="n">place</span>
</code></pre>

<h6>相關文章</h6>
<ul>
<li><a href="{{ site.baseurl }}/archives/2006/SQL~~CASE%2C%20NULLIF%28%29%20and%20ISNULL%28%29.html">SQL:: CASE, NULLIF() and ISNULL()</a></li>
</ul>
<div class="note">樂多舊網址: <a href="http://blog.roodo.com/rocksaying/archives/1051724.html">http://blog.roodo.com/rocksaying/archives/1051724.html</a></div>